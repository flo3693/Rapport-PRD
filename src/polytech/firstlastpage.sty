\def\fileversion{1.0}
\def\filedate{2001/9/10}
\def\docdate{2001/9/10}
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{polytech/firstlastpage}[\filedate\space\fileversion\space Polytech document class sub package]
\typeout{Package `polytech firstlastpage' \fileversion\space<\filedate>}

% configure output
% define if contributors details (mail and addresses) are included
\newboolean{polytech@firstlastpage@compact}
\setboolean{polytech@firstlastpage@compact}{true}

\newboolean{polytech@firstlastpage@contributorspage}
\setboolean{polytech@firstlastpage@contributorspage}{true}



% variables used to store contents to be used latter
\def\polytech@schooldepartment{undefined}

\def\polytech@typereport{undefined}

\def\polytech@reportyear{undefined}

\def\polytech@title{Undefined title}
\def\polytech@shorttitle{Undefined title}
\def\polytech@subtitle{}
\def\polytech@output@titlewithsubtitle{}

\def\polytech@date{\today}


\def\polytech@output@authors@compact{}
\def\polytech@output@authors@expanded{}
\def\polytech@output@authors@split{}
\def\polytech@output@authors@simple{}
\def\polytech@output@authors@title{}

\def\polytech@output@academicsupervisors@compact{}
\def\polytech@output@academicsupervisors@expanded{}
\def\polytech@output@academicsupervisors@split{}
\def\polytech@output@academicsupervisors@title{}

\def\polytech@output@companysupervisors@compact{}
\def\polytech@output@companysupervisors@expanded{}
\def\polytech@output@companysupervisors@split{}
\def\polytech@output@companysupervisors@title{}

\def\polytech@output@company@compact{}
\def\polytech@output@company@expanded{}
\def\polytech@output@company@split{}



\def\polytech@output@motcles{}
\def\polytech@output@keywords{}

\def\polytech@resume{}
\def\polytech@abstract{}



\pgfdeclareimage[height=2cm]{polytech@schoollogo}{polytech/polytech}
\pgfdeclareimage[height=2cm]{polytech@univlogo}{polytech/univ}


% Define title page and last page contents
\newcommand{\schooldepartment}[1]{\renewcommand{\polytech@schooldepartment}{#1}}
\newcommand{\typereport}[1]{\renewcommand{\polytech@typereport}{#1}}
\newcommand{\reportyear}[1]{\renewcommand{\polytech@reportyear}{#1}}
\newcommand{\reportlogo}[1]{\pgfdeclareimage[height=3cm]{polytech@reportlogo}{#1}}

\renewcommand{\title}[2][\polytech@title]{\renewcommand{\polytech@title}{#2}\renewcommand{\polytech@shorttitle}{#1}\renewcommand{\polytech@output@titlewithsubtitle}{#1}}
\newcommand{\subtitle}[1]{\renewcommand{\polytech@subtitle}{#1}\appto\polytech@output@titlewithsubtitle{#1}}
\renewcommand{\date}[1]{\renewcommand{\polytech@date}{#1}}


% prenom, nom, mail, fonction/promo
\renewcommand{\author}[4][]{
	\ifthenelse{\equal{\polytech@output@authors@title}{}}{
		\renewcommand{\polytech@output@authors@title}{\'Etudiant}
	}{
		\renewcommand{\polytech@output@authors@title}{\'Etudiants}
	}
	\appto\polytech@output@authors@compact{%
		\href{mailto:#4}{#2 \textsc{#3}}%
		\ifthenelse{\equal{#1}{}}{}{ (#1)}\\%
	}%
	\appto\polytech@output@authors@expanded{%
		#2 \textsc{#3}%
		\ifthenelse{\equal{#1}{}}{}{ (#1)}\\%
		\href{mailto:#4}{#4}\\
	}%
	\appto\polytech@output@authors@split{%
		#2 \textsc{#3}&\href{mailto:#4}{#4}&\'Etudiant\ifthenelse{\equal{#1}{}}{}{ #1}\\%
	}%
	\ifthenelse{\equal{\polytech@output@authors@simple}{}}{}{\appto\polytech@output@authors@simple{, }}
	\appto\polytech@output@authors@simple{#2 #3}%
}

\newcommand{\academicsupervisor}[4][]{%
	\ifthenelse{\equal{\polytech@output@academicsupervisors@title}{}}{
		\renewcommand{\polytech@output@academicsupervisors@title}{Tuteur académique}
	}{
		\renewcommand{\polytech@output@academicsupervisors@title}{Tuteurs académiques}
	}
	\appto\polytech@output@academicsupervisors@compact{%
		\href{mailto:#4}{#2 \textsc{#3}}\\%
	}%
	\appto\polytech@output@academicsupervisors@expanded{%
		#2 \textsc{#3}\\%
		\href{mailto:#4}{#4}\\
		\ifthenelse{\equal{#1}{}}{}{#1\\}
	}%
	\appto\polytech@output@academicsupervisors@split{%
		#2 \textsc{#3}&\href{mailto:#4}{#4}&Tuteur académique%
		\ifthenelse{\equal{#1}{}}{}{, #1}\\
	}%
}
\newcommand{\companysupervisor}[4][]{
	\ifthenelse{\equal{\polytech@output@companysupervisors@title}{}}{
		\renewcommand{\polytech@output@companysupervisors@title}{Tuteur entreprise}
	}{
		\renewcommand{\polytech@output@companysupervisors@title}{Tuteurs entreprise}
	}
	\appto\polytech@output@companysupervisors@compact{%
		\href{mailto:#4}{#2 \textsc{#3}}%
		\ifthenelse{\equal{#1}{}}{}{ (#1)}\\%
	}%
	\appto\polytech@output@companysupervisors@expanded{%
		#2 \textsc{#3}%
		\ifthenelse{\equal{#1}{}}{}{ (#1)}\\%
		\href{mailto:#4}{#4}\\
	}%
	\appto\polytech@output@companysupervisors@split{%
		#2 \textsc{#3}&\href{mailto:#4}{#4}&Tuteur entreprise%
		\ifthenelse{\equal{#1}{}}{}{, #1}\\
	}%
}

\newboolean{polytech@output@company@defined}
\setboolean{polytech@output@company@defined}{false}
\newcommand{\company}[4][]{
	\setboolean{polytech@output@company@defined}{true}
	\appto\polytech@output@company@compact{%
		\href{#4}{#2}%
		\ifthenelse{\equal{#1}{}}{}{\\[0.1cm]\pgfimage[height=1cm]{#1}}\\%
	}%
	\appto\polytech@output@company@expanded{%
		#2\\#3\\\href{#4}{#4}%
		\ifthenelse{\equal{#1}{}}{}{\\[0.1cm]\pgfimage[height=1cm]{#1}}\\%
	}%
	\appto\polytech@output@company@split{%
		\begin{tikzpicture}
		    \node[color=black,align=left,anchor=west] at (0,0) {
		    	#2\\#3\\\href{#4}{#4}
		    };
		    \node[color=black,align=right,anchor=east] at (\columnwidth,0) {
		    	\ifthenelse{\equal{#1}{}}{ }{\\\pgfimage[height=1cm]{#1}}
		    };
		\end{tikzpicture}%
	}
}

\newcommand{\motcle}[1]{
	\ifthenelse{\equal{\polytech@output@motcles}{}}{}{\appto\polytech@output@motcles{, }}
	\appto\polytech@output@motcles{#1}
}
\newcommand{\keyword}[1]{
\ifthenelse{\equal{\polytech@output@keywords}{}}{}{\appto\polytech@output@keywords{, }}
	\appto\polytech@output@keywords{#1}
}


\newcommand{\resume}[1]{\renewcommand{\polytech@resume}{#1}}
\newcommand{\abstract}[1]{\renewcommand{\polytech@abstract}{#1}}



\DeclareFixedFont{\polytech@font@titlepage@typereport}{\encodingdefault}{cmr}{bx}{n}{24pt}
\DeclareFixedFont{\polytech@font@titlepage@reportyear}{\encodingdefault}{cmr}{bx}{n}{18pt}
\DeclareFixedFont{\polytech@font@titlepage@title}{\encodingdefault}{cmr}{bx}{n}{32pt}
\DeclareFixedFont{\polytech@font@titlepage@subtitle}{\encodingdefault}{cmr}{bx}{n}{18pt}
\DeclareFixedFont{\polytech@font@titlepage@date}{\encodingdefault}{cmr}{n}{n}{12pt}

\renewcommand{\maketitle}{
	\frontmatter
	\begin{titlepage}
		\begin{tikzpicture}
		    \node[right,color=black,align=center] at (0,0) {\pgfuseimage{polytech@schoollogo}};
		    \node[left,color=black,align=center] at (\columnwidth,0) {\pgfuseimage{polytech@univlogo}};
		\end{tikzpicture}\\
		\polytech@output@schooladdress\\
		\vfill
		\begin{center}
			{\polytech@font@titlepage@typereport\polytech@output@typereport}\\[0.2cm]
			{\polytech@font@titlepage@reportyear\polytech@reportyear}\\[1cm]
			{\polytech@font@titlepage@title\polytech@title}\\[0.5cm]
			{\polytech@font@titlepage@subtitle\polytech@subtitle}\\
			\vspace{1cm}
			\polytech@output@reportlogo
		\end{center}
		\vfill
		\polytech@output@contributors

		\center{\polytech@font@titlepage@date\polytech@date}
	\end{titlepage}
	\polytech@output@contributorspage
%
	\hypersetup{%
		pdfauthor={\polytech@output@authors@simple},
        pdftitle={\polytech@output@titlewithsubtitle},
        pdfsubject={\polytech@output@titlewithsubtitle},
        pdfkeywords={\polytech@output@keywords,\polytech@output@motcles},
        pdfproducer={\polytech@output@authors@simple},
        pdfcreator={pdflatex, \LaTeX}}%

	\pagenumbering{roman}
	\setcounter{page}{0}

	%on réduit momentanément l'écart entre paragraphes pour ne pas trop aérer la table des matières
	\setlength{\parskip}{0em}

	\tableofcontents

	% automagically add lists of figures, tables and listings if needed
	\iftotalfigures\listoffigures\fi
	\iftotaltables\listoftables\fi
	\iftotallstlistings\lstlistoflistings\fi

	% reset page counter
	\setcounter{page}{1}
	\pagenumbering{arabic}

	\cleardoublepage
	\mainmatter
}


\newcommand{\makelastpage}{
	\polytech@output@weeklyreports
	\newpage
	\thispagestyle{empty}
	\begin{center}
		{\polytech@font@titlepage@title\polytech@title}\\[0.5cm]
		{\polytech@font@titlepage@subtitle\polytech@subtitle}\\
	\end{center}
	\vfill
	\textbf{Résumé}\\
	\polytech@resume
	\textbf{Mots-clés}\\
	\polytech@output@motcles
	\vfill
	\textbf{Abstract}\\
	\polytech@abstract
	\textbf{Keywords}\\
	\polytech@output@keywords
	\vfill
	\polytech@output@contributors
}




% commands used only for outputting contents
\newcommand{\polytech@output@department}{%
	\ifthenelse{\equal{\polytech@schooldepartment}{di}}{%
Département Informatique%
	}{ % else di
		\verb|\schooldepartment| not defined.%
	}%
}
\newcommand{\polytech@output@address}{%
	\ifthenelse{\equal{\polytech@schooldepartment}{di}}{%
64 avenue Jean Portalis\\
37200 Tours, France%
	}{ % else di
		\verb|\schooldepartment| not defined.%
	}%
}
\newcommand{\polytech@output@phone}{%
	\ifthenelse{\equal{\polytech@schooldepartment}{di}}{%
+33 (0)2 47 36 14 14%
	}{ % else di
		\verb|\schooldepartment| not defined.%
	}%
}
\newcommand{\polytech@output@schooladdress}{%
\textbf{\textsc{Ecole Polytechnique de l'Université François Rabelais de Tours}}\\%
\polytech@output@department\\%
\polytech@output@address\\%
Tél. \polytech@output@phone\\%
\href{http://www.polytech.univ-tours.fr}{www.polytech.univ-tours.fr}%
}


\newcommand{\polytech@output@typereport}{%
	\ifthenelse{\equal{\polytech@typereport}{prd}}{%
Projet Recherche \& Développement
	}{ % else di
		\verb|\typereport| not defined.%
	}%
}

\newcommand{\polytech@output@reportlogo}{\pgfuseimage{polytech@reportlogo}}




\newcommand{\polytech@output@contributors}{
	\ifthenelse{\boolean{polytech@output@company@defined}}{
		% company defined
		\begin{tikzpicture}
		    \node[color=black,align=left,anchor=north west] at (0,0) {
		    	\textbf{Entreprise}\\
		    	\ifthenelse{\boolean{polytech@firstlastpage@compact}}{\polytech@output@company@compact}{\polytech@output@company@expanded}\\
		    	\textbf{\polytech@output@companysupervisors@title}\\
		    	\ifthenelse{\boolean{polytech@firstlastpage@compact}}{\polytech@output@companysupervisors@compact}{\polytech@output@companysupervisors@expanded}
		    };
		    \node[color=black,align=right,anchor=north east] at (\columnwidth,0) {
		    	\textbf{\polytech@output@authors@title}\\
		    	\ifthenelse{\boolean{polytech@firstlastpage@compact}}{\polytech@output@authors@compact}{\polytech@output@authors@expanded}\\
		    	\textbf{\polytech@output@academicsupervisors@title}\\
		    	\ifthenelse{\boolean{polytech@firstlastpage@compact}}{\polytech@output@academicsupervisors@compact}{\polytech@output@academicsupervisors@expanded}
		    };
		\end{tikzpicture}
	}{  % no company deined
		\begin{tikzpicture}
		    \node[color=black,align=left,anchor=north west] at (0,0) {
		    	\textbf{\polytech@output@academicsupervisors@title}\\
		    	\ifthenelse{\boolean{polytech@firstlastpage@compact}}{\polytech@output@academicsupervisors@compact}{\polytech@output@academicsupervisors@expanded}
		    };
		    \node[color=black,align=right,anchor=north east] at (\columnwidth,0) {
		    	\textbf{\polytech@output@authors@title}\\
		    	\ifthenelse{\boolean{polytech@firstlastpage@compact}}{\polytech@output@authors@compact}{\polytech@output@authors@expanded}
		    };
		\end{tikzpicture}
	}
}

\newcommand{\polytech@output@contributorspage}{
	\ifthenelse{\boolean{polytech@firstlastpage@contributorspage}}{
		\thispagestyle{empty}
		\polytech@chapter@titlefont
		\begin{center}Liste des intervenants\end{center}
		\normalfont
		%
		\ifthenelse{\boolean{polytech@output@company@defined}}{
			\vspace{2cm}
			\begin{center}
				\textbf{Entreprise}\\[0.2cm]
				\fbox{\polytech@output@company@split}
			\end{center}
		}{}
		\vspace{2cm}

		\begin{tabu}{|X[c]X[c]X[c]|}
			\hline
			\textbf{Nom}&\textbf{Mail}&\textbf{Qualité}\\\hline
			\csname polytech@output@authors@split\endcsname\hline
			\csname polytech@output@academicsupervisors@split\endcsname\hline
			\csname polytech@output@companysupervisors@split\endcsname\hline
		\end{tabu}
		\newpage
	}{ % do nothing
	}%
}






