\def\fileversion{1.0}
\def\filedate{2001/9/10}
\def\docdate{2001/9/10}
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{polytech/listings}[\filedate\space\fileversion\space Polytech document class sub package]
\typeout{Package `polytech listings' \fileversion\space<\filedate>}


\ifbool{polytech@english}{
	\renewcommand{\lstlistingname}{Source code}%
	\renewcommand{\lstlistlistingname}{List of source codes}%
}%
{%
	\renewcommand{\lstlistingname}{Code source}%
	\renewcommand{\lstlistlistingname}{Liste des codes sources}%
}

\colorlet{polytech@lst@basiccolor}{black}
\colorlet{polytech@lst@keywordcolor}{black}
\colorlet{polytech@lst@commentcolor}{black}
\colorlet{polytech@lst@numberingcolor}{black}
\colorlet{polytech@lst@backgroundcolor}{black!10}
\colorlet{polytech@lst@framecolor}{black!30}
\colorlet{polytech@lst@linebreakcolor}{black}
\ifbool{polytech@blackandwhite}{
	\colorlet{polytech@lstinline@basiccolor}{black}
	\colorlet{polytech@lstinline@keywordcolor}{black}
	\colorlet{polytech@lstinline@commentcolor}{black}
}{
	\colorlet{polytech@lstinline@basiccolor}{blue}
	\colorlet{polytech@lstinline@keywordcolor}{blue}
	\colorlet{polytech@lstinline@commentcolor}{blue}
}

\newcommand{\polytech@lst@basicstyle}{\scriptsize\tt\color{polytech@lst@basiccolor}}
\newcommand{\polytech@lst@keywordstyle}{\color{polytech@lst@keywordcolor}\bf}
\newcommand{\polytech@lst@commentstyle}{\color{polytech@lst@commentcolor}\it}
\newcommand{\polytech@lst@stringstyle}{\upshape}
\newcommand{\polytech@lst@numberingstyle}{\tiny\color{polytech@lst@numberingcolor}}
\newcommand{\polytech@lst@prebreak}{\mbox{\hbox{\large\color{polytech@lst@linebreakcolor} \Leftscissors}}}
\newcommand{\polytech@lst@postbreak}{\mbox{\hbox{\color{polytech@lst@linebreakcolor}$\hookrightarrow$ }}}

\newcommand{\polytech@lstinline@basicstyle}{\tt\color{polytech@lstinline@basiccolor}}
\newcommand{\polytech@lstinline@keywordstyle}{\color{polytech@lstinline@keywordcolor}\bf}
\newcommand{\polytech@lstinline@commentstyle}{\color{polytech@lstinline@commentcolor}\it}
\newcommand{\polytech@lstinline@stringstyle}{\upshape}

% enable some french characters
\lstset{%
    literate={è}{{\`e}}1%
             {é}{{\'e}}1%
             {ë}{{\"e}}1%
             {ê}{{\^e}}1%
             {°}{{\textdegree}}1%
             {à}{{\`a}}1%
             {ù}{{\`u}}1%
             {ù}{{\`u}}1%
             {î}{{\^i}}1%
}

% base style for the environment
\lstdefinestyle{polytech@lst@base}{
	showspaces=false,%
	showstringspaces=false,%
	tabsize=2,%
	showlines=false,%
	emptylines=1,%
	basicstyle=\polytech@lst@basicstyle,%
	keywordstyle=\polytech@lst@keywordstyle,%
	commentstyle=\polytech@lst@commentstyle,%
	stringstyle=\polytech@lst@stringstyle,%
	numbers=left,%
	numberstyle=\polytech@lst@numberingstyle,%
	xleftmargin=4pt,%
	xrightmargin=4pt,%
	lineskip=2pt,%
	numbersep=8pt,%
	frame=single,%
	backgroundcolor=\color{polytech@lst@backgroundcolor},%
	rulecolor=\color{polytech@lst@framecolor},%
	breaklines=true,%
	breakatwhitespace,
	breakautoindent,%
	breakindent=40pt,%
	prebreak=\polytech@lst@prebreak,%
	postbreak=\polytech@lst@postbreak,%
	escapeinside={§}{§},% marque paragraphe (majuscule de ! sur un clavier français)
	inputencoding=utf8,%
	extendedchars=true,%
	numberbychapter=true,%
	captionpos=t,%
	resetmargins=true
}

% inline style
\lstdefinestyle{polytech@lst@inline}{
	basicstyle=\polytech@lstinline@basicstyle,%
  keywordstyle=\polytech@lstinline@keywordstyle,%
  commentstyle=\polytech@lstinline@commentstyle,%
  stringstyle=\polytech@lstinline@stringstyle,%
  inputencoding=utf8,%
  extendedchars=true,%
  showspaces=false,%
  showstringspaces=false,%
  escapeinside={§}{§}% marque paragraphe (majuscule de ! sur un clavier français)
}

% load language and specify their default variant
\lstloadlanguages{[ANSI]c,[ISO]c++,java,bash,make,xml,sql,php,python,html,scilab,matlab,[LaTeX]TeX}

\lstdefinelanguage{Javascript}{
  keywords={break,case,catch,continue,debugger,default,delete,do,else,finally,for,function,if,in,instanceof,new,return,switch,this,throw,try,typeof,var,void,while,with},
  ndkeywords={class,export,boolean,throw,implements,import,this},
  sensitive=false,
  comment=[l]{//},
  morecomment=[s]{/*}{*/},
  morestring=[b]',
  morestring=[b]"
}

% set LaTeX as default for TeX
\lstset{defaultdialect=[LaTeX]TeX}
\lstset{defaultdialect=[ISO]c++}
\lstset{defaultdialect=[ANSI]c}


\newcommand{\newsourceformat}[2]{
	\polytech@newsourceformat@file{#1sourcefile}{#2}
	\polytech@newsourceformat@env{#1source}{#2}
	\polytech@newsourceformat@code{#1code}{#2}
	\polytech@newsourceformat@codeintab{#1codeintab}{#2}
}

\newcommand{\polytech@newsourceformat@code}[2]{
	\expandafter\newcommand\csname #1\endcsname[2][]{\texorpdfstring{\lstinline[style=polytech@lst@inline,language=#2,##1]{##2}}{##2}}
	\expandafter\MakeRobustCommand\csname #1\endcsname
}

\newcommand{\polytech@newsourceformat@codeintab}[2]{
	\expandafter\def\csname #1\endcsname{\lstset{style=polytech@lst@inline,language=#2}\lstinline}
}

\newcommand{\polytech@newsourceformat@file}[2]{
	\expandafter\newcommand\csname #1\endcsname[2][]{\lstset{style=polytech@lst@base,language=#2,##1}\lstinputlisting{##2}}
}

\newcommand{\polytech@newsourceformat@env}[2]{%
	\lstnewenvironment{#1}[1][]{\lstset{style=polytech@lst@base,language=#2,##1}\csuse{\@lst @SetFirstNumber}}{\csuse{\@lst @SaveFirstNumber}}
}

% standard language

\newsourceformat{c}{C}
\newsourceformat{cpp}{C++}
\newsourceformat{java}{Java}
\newsourceformat{bash}{bash}
\newsourceformat{make}{make}
\newsourceformat{javascript}{Javascript}
\newsourceformat{xml}{XML}
\newsourceformat{sql}{SQL}
\newsourceformat{php}{PHP}
\newsourceformat{python}{Python}
\newsourceformat{html}{HTML}
\newsourceformat{scilab}{Scilab}
\newsourceformat{matlab}{Matlab}
\newsourceformat{latex}{TeX}

%
%
%
%
%
%
%
%
%
%
% \lstnewenvironment{source}[1][\polytech@lst@defaultlanguage]{\lstset{style=polytech@lst@base,#1}\csname\@lst @SetFirstNumber\endcsname}{\csname\@lst @SaveFirstNumber\endcsname}
% \lstnewenvironment{csource}[1][]{\lstset{style=polytech@lst@base,language=c,#1}\csname\@lst @SetFirstNumber\endcsname}{\csname\@lst @SaveFirstNumber\endcsname}
% \lstnewenvironment{cppsource}[1][]{\lstset{style=polytech@lst@base,language=c++,#1}\csname\@lst @SetFirstNumber\endcsname}{\csname\@lst @SaveFirstNumber\endcsname}
% \lstnewenvironment{javasource}[1][]{\lstset{style=polytech@lst@base,language=java,#1}\csname\@lst @SetFirstNumber\endcsname}{\csname\@lst @SaveFirstNumber\endcsname}
% \lstnewenvironment{bashsource}[1][]{\lstset{style=polytech@lst@base,language=bash,#1}\csname\@lst @SetFirstNumber\endcsname}{\csname\@lst @SaveFirstNumber\endcsname}
% \lstnewenvironment{makesource}[1][]{\lstset{style=polytech@lst@base,language=make,#1}\csname\@lst @SetFirstNumber\endcsname}{\csname\@lst @SaveFirstNumber\endcsname}
% \lstnewenvironment{javascriptsource}[1][]{\lstset{style=polytech@lst@base,language=javascript,#1}\csname\@lst @SetFirstNumber\endcsname}{\csname\@lst @SaveFirstNumber\endcsname}
% \lstnewenvironment{xmlsource}[1][]{\lstset{style=polytech@lst@base,language=xml,#1}\csname\@lst @SetFirstNumber\endcsname}{\csname\@lst @SaveFirstNumber\endcsname}
% \lstnewenvironment{sqlsource}[1][]{\lstset{style=polytech@lst@base,language=sql,#1}\csname\@lst @SetFirstNumber\endcsname}{\csname\@lst @SaveFirstNumber\endcsname}
% \lstnewenvironment{phpsource}[1][]{\lstset{style=polytech@lst@base,language=php,#1}\csname\@lst @SetFirstNumber\endcsname}{\csname\@lst @SaveFirstNumber\endcsname}
% \lstnewenvironment{pythonsource}[1][]{\lstset{style=polytech@lst@base,language=python,#1}\csname\@lst @SetFirstNumber\endcsname}{\csname\@lst @SaveFirstNumber\endcsname}
% \lstnewenvironment{htmlsource}[1][]{\lstset{style=polytech@lst@base,language=html,#1}\csname\@lst @SetFirstNumber\endcsname}{\csname\@lst @SaveFirstNumber\endcsname}
% \lstnewenvironment{scilabsource}[1][]{\lstset{style=polytech@lst@base,language=scilab,#1}\csname\@lst @SetFirstNumber\endcsname}{\csname\@lst @SaveFirstNumber\endcsname}
% \lstnewenvironment{matlabsource}[1][]{\lstset{style=polytech@lst@base,language=matlab,#1}\csname\@lst @SetFirstNumber\endcsname}{\csname\@lst @SaveFirstNumber\endcsname}
% \lstnewenvironment{latexsource}[1][]{\lstset{style=polytech@lst@base,language=TeX,#1}\csname\@lst @SetFirstNumber\endcsname}{\csname\@lst @SaveFirstNumber\endcsname}
%
%
%
% \newcommand{\sourcefile}[2][]{\lstset{style=polytech@lst@base,#1}\lstinputlisting{#2}}
% \newcommand{\csourcefile}[2][]{\lstset{style=polytech@lst@base,language=c,#1}\lstinputlisting{#2}}
% \newcommand{\cppsourcefile}[2][]{\lstset{style=polytech@lst@base,language=c++,#1}\lstinputlisting{#2}}
% \newcommand{\javasourcefile}[2][]{\lstset{style=polytech@lst@base,language=java,#1}\lstinputlisting{#2}}
% \newcommand{\bashsourcefile}[2][]{\lstset{style=polytech@lst@base,language=bash,#1}\lstinputlisting{#2}}
% \newcommand{\makesourcefile}[2][]{\lstset{style=polytech@lst@base,language=make,#1}\lstinputlisting{#2}}
% \newcommand{\javascriptsourcefile}[2][]{\lstset{style=polytech@lst@base,language=javascript,#1}\lstinputlisting{#2}}
% \newcommand{\xmlsourcefile}[2][]{\lstset{style=polytech@lst@base,language=xml,#1}\lstinputlisting{#2}}
% \newcommand{\sqlsourcefile}[2][]{\lstset{style=polytech@lst@base,language=sql,#1}\lstinputlisting{#2}}
% \newcommand{\phpsourcefile}[2][]{\lstset{style=polytech@lst@base,language=php,#1}\lstinputlisting{#2}}
% \newcommand{\pythonsourcefile}[2][]{\lstset{style=polytech@lst@base,language=python,#1}\lstinputlisting{#2}}
% \newcommand{\htmlsourcefile}[2][]{\lstset{style=polytech@lst@base,language=html,#1}\lstinputlisting{#2}}
% \newcommand{\scilabsourcefile}[2][]{\lstset{style=polytech@lst@base,language=scilab,#1}\lstinputlisting{#2}}
% \newcommand{\matlabsourcefile}[2][]{\lstset{style=polytech@lst@base,language=matlab,#1}\lstinputlisting{#2}}
% \newcommand{\latexsourcefile}[2][]{\lstset{style=polytech@lst@base,language=TeX,#1}\lstinputlisting{#2}}
%
%
%
%
% \def\ccode#1{\texorpdfstring{\lstinline[style=polytech@lst@inline,language=c]{#1}}{#1}}
% \def\cppcode#1{\texorpdfstring{\lstinline[style=polytech@lst@inline,language=c++]{#1}}{#1}}
% \def\javacode#1{\texorpdfstring{\lstinline[style=polytech@lst@inline,language=java]{#1}}{#1}}
% \def\bashcode#1{\texorpdfstring{\lstinline[style=polytech@lst@inline,language=bash]{#1}}{#1}}
% \def\makecode#1{\texorpdfstring{\lstinline[style=polytech@lst@inline,language=make]{#1}}{#1}}
% \def\javascriptcode#1{\texorpdfstring{\lstinline[style=polytech@lst@inline,language=javascript]{#1}}{#1}}
% \def\xmlcode#1{\texorpdfstring{\lstinline[style=polytech@lst@inline,language=xml]{#1}}{#1}}
% \def\sqlcode#1{\texorpdfstring{\lstinline[style=polytech@lst@inline,language=sql]{#1}}{#1}}
% \def\phpcode#1{\texorpdfstring{\lstinline[style=polytech@lst@inline,language=php]{#1}}{#1}}
% \def\pythoncode#1{\texorpdfstring{\lstinline[style=polytech@lst@inline,language=python]{#1}}{#1}}
% \def\htmlcode#1{\texorpdfstring{\lstinline[style=polytech@lst@inline,language=html]{#1}}{#1}}
% \def\scilabcode#1{\texorpdfstring{\lstinline[style=polytech@lst@inline,language=scilab]{#1}}{#1}}
% \def\matlabcode#1{\texorpdfstring{\lstinline[style=polytech@lst@inline,language=matlab]{#1}}{#1}}
% \def\latexcode#1{\texorpdfstring{\lstinline[style=polytech@lst@inline,language=TeX]{#1}}{#1}}
%
% % make commands robust to be usable in other command like block or sectionning
% \MakeRobustCommand\ccode
% \MakeRobustCommand\cppcode
% \MakeRobustCommand\javacode
% \MakeRobustCommand\bashcode
% \MakeRobustCommand\makecode
% \MakeRobustCommand\javascriptcode
% \MakeRobustCommand\xmlcode
% \MakeRobustCommand\sqlcode
% \MakeRobustCommand\phpcode
% \MakeRobustCommand\pythoncode
% \MakeRobustCommand\htmlcode
% \MakeRobustCommand\scilabcode
% \MakeRobustCommand\matlabcode
% \MakeRobustCommand\latexcode
%
%
%
% % for inserting code in tabular environment. Work similarly to \lstinline so need the same char at start and end
% \def\ccodeintab{\lstset{style=polytech@lst@inline,language=c}\lstinline}
% \def\cppcodeintab{\lstset{style=polytech@lst@inline,language=c++}\lstinline}
% \def\javacodeintab{\lstset{style=polytech@lst@inline,language=java}\lstinline}
% \def\makecodeintab{\lstset{style=polytech@lst@inline,language=bash}\lstinline}
% \def\makecodeintab{\lstset{style=polytech@lst@inline,language=make}\lstinline}
% \def\javascriptcodeintab{\lstset{style=polytech@lst@inline,language=javascript}\lstinline}
% \def\xmlcodeintab{\lstset{style=polytech@lst@inline,language=xml}\lstinline}
% \def\sqlcodeintab{\lstset{style=polytech@lst@inline,language=sql}\lstinline}
% \def\phpcodeintab{\lstset{style=polytech@lst@inline,language=php}\lstinline}
% \def\pythoncodeintab{\lstset{style=polytech@lst@inline,language=python}\lstinline}
% \def\htmlcodeintab{\lstset{style=polytech@lst@inline,language=html}\lstinline}
% \def\scilabcodeintab{\lstset{style=polytech@lst@inline,language=scilab}\lstinline}
% \def\matlabcodeintab{\lstset{style=polytech@lst@inline,language=matlab}\lstinline}
% \def\latexcodeintab{\lstset{style=polytech@lst@inline,language=TeX}\lstinline}
%
%
%
%
%
%



