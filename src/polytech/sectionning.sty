%###
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PART
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% part page
\csdef{polytech@part@numberfont}{\bfseries\Huge}
\csdef{polytech@part@titlefont}{\bfseries\Huge}

% override titlesec command to remove superflous blank pages
\def\ttl@page@ii#1#2#3#4#5#6#7{%
  \ttl@assign\@tempskipa#3\relax\beforetitleunit
  \if@openright
    \cleardoublepage
  \else
    \clearpage
  \fi
  \@ifundefined{ttl@ps@#6}%
    {\thispagestyle{plain}}%
    {\thispagestyle{\@nameuse{ttl@ps@#6}}}%
  \vspace*{\@tempskipa}%
  \@afterindenttrue
  \ifcase#5 \@afterindentfalse\fi
  \ttl@assign\@tempskipb#4\relax\aftertitleunit
  \ttl@select{#6}{#1}{#2}{#7}%
  \ttl@finmarks
  \@ifundefined{ttlp@#6}{}{\ttlp@write{#6}}%
  \vspace{\@tempskipb}%
  \ignorespaces}

%\titlespacing{\part}{0pt}{3cm}{3cm}

\titleformat{\part}[display]
{\global\setbool{polytech@titlesec@hasnumber}{false}}%
{\global\setbool{polytech@titlesec@hasnumber}{true}}%
{0cm}%
{%
	\thispagestyle{empty}
    \begin{tikzpicture}
       \draw[color=black!50,fill=black!70] (0,0) rectangle (\textwidth-0.4pt,2.5);
       \draw[color=black!50,fill=black!50] (0.25,0.25) rectangle (3.25,3.25);
       \ifbool{polytech@titlesec@hasnumber}{%
       		\node[right,color=black!70,text width=\textwidth-4cm-0.4pt,align=center] at (3.5,3.5) {\csname polytech@part@numberfont\endcsname\partname};
       }{}
       \node[right,white,text width=\textwidth-4cm-0.4pt,align=center] at (3.5,1.25) {\csname polytech@part@titlefont\endcsname#1};
     \end{tikzpicture}%
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CHAPTER
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



% chapter page

\csdef{polytech@chapter@numberfont}{\bfseries\fontsize{2cm}{1em}\selectfont}
\csdef{polytech@chapter@titlefont}{\bfseries\Huge}

%    \renewcommand{\chaptername}{Chapitre}
%    \renewcommand{\appendixname}{Annexe}

\newbool{polytech@titlesec@hasnumber}
\newlength{\polytech@chapter@numwidth}

% Override standard definition of \chapter,\chapter* to remove \@topnewpage if twocolumns
% \def\@chapter[#1]#2{%
%   \ifnum \c@secnumdepth >\m@ne
%      \if@mainmatter
%        \refstepcounter{chapter}%
%        \typeout{\@chapapp\space\thechapter.}%
%        \addcontentsline{toc}{chapter}%
%                  {\protect\numberline{\thechapter}#1}%
%      \else
%        \addcontentsline{toc}{chapter}{#1}%
%      \fi
%   \else
%     \addcontentsline{toc}{chapter}{#1}%
%   \fi
%   \chaptermark{#1}%
%   \addtocontents{lof}{\protect\addvspace{10\p@}}%
%   \addtocontents{lot}{\protect\addvspace{10\p@}}%
%     \@makechapterhead{#2}%
%     \@afterheading%
%               }
% \def\@schapter#1{%
%               \@makeschapterhead{#1}%
%               \@afterheading%
%             }

\titlespacing{\chapter}{0pt}{2cm}{6cm}

\titleformat{\chapter}%
   {\global\setbool{polytech@titlesec@hasnumber}{false}}%
   {\global\setbool{polytech@titlesec@hasnumber}{true}}%
   {0pt}%
   {%
     \begin{tikzpicture}%
       \draw[color=black!50,fill=black!70] (0,0) rectangle (\textwidth-1pt,2.5);%
       \draw[color=black!50,fill=black!50] (0.25,0.25) rectangle (3.25,3.25);%
       \ifbool{polytech@titlesec@hasnumber}{%
         \node[inner sep=2em,color=white] at (1.75,1.75) {\csname polytech@chapter@numberfont\endcsname\thechapter};%
       }{}%
       \node[right,white,text width=\textwidth-4cm] at (3.5,1.25) {\csname polytech@chapter@titlefont\endcsname#1};%
     \end{tikzpicture}%
   }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SECTION
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\csdef{polytech@section@numberfont}{\bfseries\Large}
\csdef{polytech@section@titlefont}{\bfseries\Large}

\titlespacing{\section}{0pt}{2ex plus 1ex minus 0.5ex}{2ex plus 1ex minus 0.5ex}

\titleformat{\section}[block]{\global\setbool{polytech@titlesec@hasnumber}{false}}{\global\setbool{polytech@titlesec@hasnumber}{true}}{0pt}%
  {%
    \begin{tikzpicture}[color=white]
    %
      \node[
        text width=\textwidth-0.4cm-0.4pt,
        fill=black!70,
        draw=black!50,
        inner sep=0.2cm,
        inner ysep=0.2cm] (title)
        at (0,0) {\polytech@section@titlefont#1} ;
      \path (title.south); \pgfgetlastxy{\titlexS}{\titleyS}
      \path (title.north); \pgfgetlastxy{\titlexN}{\titleyN}
      \ifbool{polytech@titlesec@hasnumber}{%
        \node[ align=center,
               fill=black!50,
               draw=black!50,
               inner xsep=0.2cm,
               minimum height=\titleyN-\titleyS-0.4cm,
               overlay,
               anchor=east,
               left=-0.1cm of title.west
             ] at (title.west) {\polytech@section@numberfont\arabic{section}};
      }{}
     \end{tikzpicture}%
    }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SUBSECTION
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\csdef{polytech@subsection@numberfont}{\bfseries\large}
\csdef{polytech@subsection@titlefont}{\bfseries\large}

\titlespacing{\subsection}{0pt}{2ex plus 1ex minus 0.5ex}{2ex plus 1ex minus 0.5ex}

\titleformat{\subsection}[block]{\global\setbool{polytech@titlesec@hasnumber}{false}}{\global\setbool{polytech@titlesec@hasnumber}{true}}{0pt}%
  {%
    \begin{tikzpicture}[color=white]
    %
      \node[
        text width=\textwidth-0.4cm-0.4pt,
        fill=black!70,
        draw=black!50,
        inner sep=0.2cm,
        inner ysep=0.2cm] (title)
        at (0,0) {\polytech@subsection@titlefont#1} ;
      \path (title.south); \pgfgetlastxy{\titlexS}{\titleyS}
      \path (title.north); \pgfgetlastxy{\titlexN}{\titleyN}
      \ifbool{polytech@titlesec@hasnumber}{%
        \node[ align=center,
               fill=black!50,
               draw=black!50,
               inner xsep=0.2cm,
               minimum height=\titleyN-\titleyS-0.4cm,
               overlay,
               anchor=east,
               left=-0.1cm of title.west
             ] at (title.west) {\polytech@subsection@numberfont\arabic{section}.\arabic{subsection}};
      }{}
     \end{tikzpicture}%
    }


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SUBSUBSECTION
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\csdef{polytech@subsubsection@numberfont}{\large}
\csdef{polytech@subsubsection@titlefont}{\large}

\titlespacing{\subsubsection}{0pt}{2ex plus 1ex minus 0.5ex}{2ex plus 1ex minus 0.5ex}

\titleformat{\subsubsection}[block]{\global\setbool{polytech@titlesec@hasnumber}{false}}{\global\setbool{polytech@titlesec@hasnumber}{true}}{0pt}%
  {%
    \begin{tikzpicture}[color=white]
    %
      \node[
        text width=\textwidth-0.4cm-0.4pt,
        fill=black!70,
        draw=black!50,
        inner sep=0.2cm,
        inner ysep=0.2cm] (title)
        at (0,0) {\polytech@subsubsection@titlefont#1} ;
      \path (title.south); \pgfgetlastxy{\titlexS}{\titleyS}
      \path (title.north); \pgfgetlastxy{\titlexN}{\titleyN}
      \ifbool{polytech@titlesec@hasnumber}{%
        \node[ align=center,
               fill=black!50,
               draw=black!50,
               inner xsep=0.2cm,
               minimum height=\titleyN-\titleyS-0.4cm,
               overlay,
               anchor=east,
               left=-0.1cm of title.west
             ] at (title.west) {\polytech@subsubsection@numberfont\arabic{section}.\arabic{subsection}.\arabic{subsubsection}};
      }{}
    \end{tikzpicture}%
  }


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PARAGRAPH
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\csdef{polytech@paragraph@titlefont}{\bfseries\normalsize}

\titlespacing{\paragraph}{0pt}{1ex plus 1ex minus 0.5ex}{1ex plus 0.1ex minus 0.1ex}

\titleformat{\paragraph}[hang]{\color{black}\csname polytech@paragraph@titlefont\endcsname}{\theparagraph}{0pt}{#1}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SUBPARAGRAPH
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\csdef{polytech@subparagraph@titlefont}{\bfseries\itshape\normalsize}

\titlespacing{\subparagraph}{0pt}{1ex plus 1ex minus 0.5ex}{1ex plus 0.1ex minus 0.1ex}

\titleformat{\subparagraph}[hang]{\color{black}\csname polytech@subparagraph@titlefont\endcsname}{\thesubparagraph}{0pt}{#1}





%###